<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Pengaduan, Kritik & Saran - UPT Puskesmas Cibatu</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      background: linear-gradient(135deg, #16a085, #1abc9c);
      font-family: "Poppins", sans-serif;
      animation: fadeIn 1.2s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .form-container { animation: slideUp 0.9s ease-in-out; }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    label { font-weight: 600; }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen px-4">
  <div class="form-container bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full">
    <h1 class="text-2xl font-bold text-center text-gray-800 mb-4">
      üí¨ Pengaduan, Kritik & Saran
    </h1>
    <p class="text-sm text-gray-600 text-center mb-6">
      Sampaikan pendapat Anda untuk meningkatkan pelayanan di
      <b>UPT Puskesmas Cibatu</b>.
    </p>

    <form id="formPengaduan" class="space-y-4">
      <div>
        <label for="nama" class="block text-gray-700">Nama Lengkap</label>
        <input type="text" id="nama" name="nama" required
          class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-green-300 outline-none" />
      </div>

      <div>
        <label for="kontak" class="block text-gray-700">Nomor Kontak / Email</label>
        <input type="text" id="kontak" name="kontak" required
          class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-green-300 outline-none" />
      </div>

      <div>
        <label for="jenis" class="block text-gray-700">Jenis Pesan</label>
        <select id="jenis" name="jenis" required
          class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-green-300 outline-none">
          <option value="">-- Pilih Jenis --</option>
          <option value="Pengaduan">Pengaduan</option>
          <option value="Kritik">Kritik</option>
          <option value="Saran">Saran</option>
        </select>
      </div>

      <div>
        <label for="pesan" class="block text-gray-700">Isi Pesan</label>
        <textarea id="pesan" name="pesan" rows="4" required
          class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-green-300 outline-none"></textarea>
      </div>

      <div>
        <label for="file" class="block text-gray-700">Upload Foto / Dokumen (opsional)</label>
        <input type="file" id="file" name="file" accept="image/*,.pdf,.doc,.docx"
          class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-green-300 outline-none" />
      </div>

      <button type="submit"
        class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold">
        Kirim
      </button>
    </form>

    <p class="text-xs text-gray-500 mt-6 text-center">
      Data Anda akan otomatis disimpan di sistem pengaduan kami (Google Sheet)
      dan file di Google Drive resmi Puskesmas.
    </p>
  </div>

  <script>
    // URL Google Apps Script kamu
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz3NiPNZhIc_lQIiZXxw0MD3kPe_6GvqZqCs0b3w2TNJUKo-5ofr_pF9BTwTdkmjcNABw/exec";

    // Proxy publik untuk bypass CORS (tidak perlu ubah)
    const PROXY_URL = "https://corsproxy.io/?";

    document.getElementById("formPengaduan").addEventListener("submit", async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById("file");
      const file = fileInput.files[0];

      let base64File = "";
      let filename = "";
      let mimeType = "";

      if (file) {
        const reader = new FileReader();
        reader.onload = async () => {
          base64File = reader.result.split(",")[1];
          filename = file.name;
          mimeType = file.type;
          await kirimData();
        };
        reader.readAsDataURL(file);
      } else {
        await kirimData();
      }

      async function kirimData() {
        Swal.fire({
          title: "Mengirim...",
          text: "Mohon tunggu sebentar.",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        const data = {
          nama: document.getElementById("nama").value,
          kontak: document.getElementById("kontak").value,
          jenis: document.getElementById("jenis").value,
          pesan: document.getElementById("pesan").value,
          file: base64File,
          filename: filename,
          mimeType: mimeType,
        };

        try {
          const res = await fetch(PROXY_URL + GAS_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const text = await res.text();

          if (text.includes("Sukses")) {
            Swal.fire("‚úÖ Berhasil!", "Terima kasih sudah mengirim pesan!", "success");
            document.getElementById("formPengaduan").reset();
          } else {
            Swal.fire("‚ö†Ô∏è Gagal", "Terjadi kesalahan: " + text, "error");
          }
        } catch (error) {
          Swal.fire("‚ùå Error", "Tidak bisa mengirim data. Periksa koneksi atau izin Apps Script.", "error");
        }
      }
    });
  </script>
</body>
</html>
