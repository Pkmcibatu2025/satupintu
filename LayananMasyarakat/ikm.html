<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Survei Kepuasan Masyarakat - UPT Puskesmas Cibatu</title>
  <meta name="description" content="Formulir Survei Kepuasan Masyarakat (IKM) UPT Puskesmas Cibatu" />
  <style>
    :root{
      --primary:#004d80;
      --accent:#ff9900;
      --bg:#f5f8fa;
      --card:#ffffff;
      --text:#123;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      background:var(--primary);
      color:#fff;
      padding:14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
    }
    .logo{display:flex;gap:10px;align-items:center}
    .logo img{height:44px;background:#fff;border-radius:6px;padding:4px}
    .logo h1{margin:0;font-size:18px;font-weight:700}
    header nav a{color:#fff;text-decoration:none;font-weight:600}
    header nav a:hover{color:#ffd23f}
    main{max-width:1100px;margin:20px auto;padding:0 16px 80px}
    .card{
      background:var(--card);
      border-radius:12px;
      box-shadow:0 6px 24px rgba(12,40,60,0.08);
      padding:20px;
      margin-bottom:18px;
    }
    .hero{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .hero .thumb{
      flex-shrink:0;
      width:220px;
      height:120px;
      border-radius:10px;
      background:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=900&q=60') center/cover;
    }
    .hero h2{margin:0 0 10px;font-size:20px;color:var(--primary)}
    form .section-title{font-weight:700;color:var(--primary);margin:16px 0 10px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
    label{font-size:13px;margin-bottom:4px;display:block}
    input,select,textarea{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:14px;
    }
    textarea{min-height:80px;resize:vertical}
    .services-wrap{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .chip{
      padding:8px 10px;
      border-radius:20px;
      background:#f0f6fb;
      color:var(--primary);
      font-weight:600;
      cursor:pointer;
    }
    .chip.selected{background:var(--primary);color:#fff}
    .question{background:#fbfdff;padding:12px;border-radius:8px;border:1px solid #eef6ff;margin-top:10px}
    .q-row{display:flex;gap:10px;flex-wrap:wrap}
    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}
    button.primary{
      background:var(--primary);
      color:#fff;
      border:none;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }
    button.secondary{
      background:transparent;
      border:1px solid #ccc;
      padding:10px 16px;
      border-radius:10px;
      cursor:pointer;
    }
    .toast{
      position:fixed;right:18px;bottom:18px;
      background:#063;color:#fff;
      padding:12px 16px;border-radius:10px;
      display:none;
    }
    .toast.show{display:block}
    @media(max-width:768px){
      .hero{flex-direction:column}
      .hero .thumb{width:100%;height:160px}
      .actions{flex-direction:column-reverse}
      button{width:100%}
    }
  </style>
</head>
<body>
<header>
  <div class="logo">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Logo_Kabupaten_Garut.png" alt="logo">
    <div>
      <h1>UPT Puskesmas Cibatu</h1>
      <div style="font-size:12px;opacity:.9">Dinas Kesehatan Kab. Garut</div>
    </div>
  </div>
  <nav><a href="/satupintu/pengaduan.html">üè† Beranda</a></nav>
</header>

<main>
  <div class="card hero">
    <div>
      <h2>Survei Kepuasan Masyarakat (IKM)</h2>
      <p>Terima kasih telah meluangkan waktu. Jawaban Anda membantu kami meningkatkan mutu pelayanan.</p>
      <small>Durasi ¬±2‚Äì5 menit ‚Ä¢ Skala 1‚Äì4</small>
    </div>
    <div class="thumb" aria-hidden="true"></div>
  </div>

  <form id="ikmForm" class="card">
    <div class="section-title">A. Data Responden</div>
    <div class="grid">
      <div>
        <label>Nama Pasien</label>
        <input name="res_number" required placeholder="Nama lengkap">
      </div>
      <div>
        <label>Umur (Tahun)</label>
        <input name="age" type="number" min="1" required>
      </div>
      <div>
        <label>Jenis Kelamin</label>
        <select name="gender" required>
          <option value="">Pilih...</option>
          <option>Laki-laki</option>
          <option>Perempuan</option>
        </select>
      </div>
      <div>
        <label>Pendidikan Terakhir</label>
        <select name="education" required>
          <option value="">Pilih...</option>
          <option>SD ke Bawah</option>
          <option>SLTP / Sederajat</option>
          <option>SLTA / Sederajat</option>
          <option>D1-D4</option>
          <option>S-1</option>
          <option>S-2 ke Atas</option>
        </select>
      </div>
      <div>
        <label>Pekerjaan Utama</label>
        <select name="job" required>
          <option value="">Pilih...</option>
          <option>Pimpinan Perusahaan</option>
          <option>Manager/Wakil Manajemen</option>
          <option>Wiraswasta</option>
          <option>PNS/TNI/Polri</option>
          <option>Karyawan Swasta</option>
          <option>Ibu Rumah Tangga</option>
          <option>Pelajar/Mahasiswa</option>
          <option>Tidak Bekerja</option>
          <option>Lainnya</option>
        </select>
      </div>
      <div class="full">
        <label>Jenis Layanan</label>
        <div class="services-wrap" id="serviceChips">
          <div class="chip" data-val="Pendaftaran">Pendaftaran</div>
          <div class="chip" data-val="Kasir">Kasir</div>
          <div class="chip" data-val="Pelayanan Usia Produktif">Usia Produktif / Dewasa</div>
          <div class="chip" data-val="KB">KB</div>
          <div class="chip" data-val="Gigi">Gigi dan Mulut</div>
          <div class="chip" data-val="KIA">Kesehatan Ibu & Anak</div>
          <div class="chip" data-val="Lansia">Lansia</div>
          <div class="chip" data-val="Apotek">Apotek</div>
          <div class="chip" data-val="UGD">UGD</div>
          <div class="chip" data-val="Rawat Inap">Rawat Inap</div>
          <div class="chip" data-val="Laboratorium">Laboratorium</div>
          <div class="chip" data-val="PUSTU">PUSTU</div>
        </div>
        <input id="service_other" name="service_other" placeholder="Jika lain-lain, tulis di sini">
      </div>
    </div>

    <hr style="margin:16px 0;border:none;border-top:1px solid #eef6ff">

    <div class="section-title">B. Data Alamat</div>
    <div class="grid">
      <div>
        <label>Alamat</label>
        <input name="surveyor_name" required placeholder="Alamat lengkap">
      </div>
      <div>
        <label>Pilih Desa</label>
        <select name="surveyor_nip" required>
          <option value="">Pilih Desa...</option>
          <option>Cibatu</option>
          <option>Kertajaya</option>
          <option>Wanakerta</option>
          <option>Keresek</option>
          <option>Padasuka</option>
          <option>Cibunar</option>
          <option>Sindangsuka</option>
          <option>Mekarsari</option>
          <option>Karyamukti</option>
          <option>Sukalilah</option>
          <option>Girimukti</option>
        </select>
      </div>
      <div>
        <label>Tanggal Survei</label>
        <input type="date" name="survey_date" required>
      </div>
      <div>
        <label>Jam Survei</label>
        <select name="survey_time" required>
          <option value="">Pilih...</option>
          <option>08.00 ‚Äì 12.00</option>
          <option>13.00 ‚Äì 17.00</option>
        </select>
      </div>
    </div>

    <hr style="margin:16px 0;border:none;border-top:1px solid #eef6ff">

    <div class="section-title">C. Pendapat Responden</div>
    <div id="questions"></div>

    <div class="full" style="margin-top:12px">
      <label>Saran / Masukan</label>
      <textarea name="suggestion" required placeholder="Tuliskan saran Anda di sini"></textarea>
    </div>

    <div class="actions">
      <button type="button" class="secondary" id="resetBtn">Reset</button>
      <button type="submit" class="primary" id="submitBtn">Kirim Jawaban</button>
    </div>
  </form>
</main>

<div id="toast" class="toast">Terkirim ‚Äî Terima kasih!</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyEMzmJ29DD7qndZYMZ5dJmeErAMK-FAGj-Lob8qfBr5EYl7TIersNmtC0-qLg4L8t6/exec";

// buat daftar pertanyaan otomatis
const pertanyaan = [
  "Kesesuaian persyaratan pelayanan dengan jenis pelayanannya",
  "Kemampuan petugas dalam memberikan pelayanan",
  "Kemudahan prosedur pelayanan",
  "Perilaku petugas (kesopanan & keramahan)",
  "Kecepatan waktu dalam memberikan pelayanan",
  "Penanganan pengaduan pengguna layanan",
  "Kewajaran biaya/tarif dalam pelayanan",
  "Kualitas sarana dan prasarana",
  "Kesesuaian produk pelayanan dengan standar pelayanan"
];
const qContainer = document.getElementById('questions');
pertanyaan.forEach((text,i)=>{
  const div=document.createElement('div');
  div.className='question';
  div.innerHTML=`<p>${i+1}. ${text}</p>
    <div class="q-row small">
      <label><input required type="radio" name="q${i+1}" value="1"> 1</label>
      <label><input type="radio" name="q${i+1}" value="2"> 2</label>
      <label><input type="radio" name="q${i+1}" value="3"> 3</label>
      <label><input type="radio" name="q${i+1}" value="4"> 4</label>
    </div>`;
  qContainer.appendChild(div);
});

// chip select
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click',()=>c.classList.toggle('selected'));
});
document.getElementById('resetBtn').onclick=()=>{
  document.getElementById('ikmForm').reset();
  document.querySelectorAll('.chip').forEach(ch=>ch.classList.remove('selected'));
};

// submit handler
document.getElementById('ikmForm').addEventListener('submit',async ev=>{
  ev.preventDefault();
  const form=ev.target;
  const submitBtn=document.getElementById('submitBtn');
  submitBtn.disabled=true;submitBtn.textContent='Mengirim...';
  const data=Object.fromEntries(new FormData(form).entries());
  data.services=Array.from(document.querySelectorAll('.chip.selected')).map(el=>el.dataset.val).join('; ')||data.service_other||'';
  data.timestamp=new Date().toISOString();
  try{
    const resp=await fetch(WEBAPP_URL,{
      method:'POST',mode:'cors',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    const resJson=await resp.json();
    if(resp.ok && resJson.status==='success'){
      const t=document.getElementById('toast');
      t.classList.add('show');t.textContent='Terkirim ‚Äî Terima kasih!';
      setTimeout(()=>t.classList.remove('show'),3500);
      form.reset();
      document.querySelectorAll('.chip').forEach(ch=>ch.classList.remove('selected'));
    }else alert('Gagal: '+(resJson.message||resp.statusText));
  }catch(err){
    alert('Kesalahan: '+err.message);
  }finally{
    submitBtn.disabled=false;submitBtn.textContent='Kirim Jawaban';
  }
});
</script>
</body>
</html>
