<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Survey IKM - UPT Puskesmas Cibatu</title>
  <style>
    :root{
      --primary: #004d80;
      --accent: #ffb703;
      --bg: #f5f8fa;
      --card: #fff;
      --text: #122;
      --focus-color: #ffd23f;
    }
    body{margin:0;font-family:"Poppins",sans-serif;background:var(--bg);color:var(--text);transition:all .25s}
    header{background:var(--primary);color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .logo{display:flex;gap:12px;align-items:center}
    .logo img{height:44px;border-radius:6px;background:#fff;padding:4px}
    .logo h1{margin:0;font-size:18px}
    nav{display:flex;gap:8px;align-items:center}
    .access-btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    .access-btn:focus{outline:3px solid var(--focus-color);outline-offset:3px}
    a.home{color:#fff;text-decoration:none;font-weight:600}
    main{max-width:1100px;margin:18px auto;padding:0 16px 80px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.06);margin-bottom:16px}
    .hero{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .thumb{width:220px;height:120px;border-radius:10px;background:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=900&q=60')center/cover;flex-shrink:0}
    h2{color:var(--primary);margin:0 0 8px}
    form .section-title{font-weight:700;color:var(--primary);margin:18px 0 10px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #bfc9d6;font-size:15px}
    textarea{min-height:110px;resize:vertical}
    input[type="number"]::-webkit-inner-spin-button {opacity: 1;}
    .services-wrap{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:8px 12px;border-radius:999px;background:#eef6ff;color:var(--primary);font-weight:700;cursor:pointer;border:1px solid transparent}
    .chip.selected{background:var(--primary);color:#fff}

    .question{background:#fbfdff;padding:14px;border-radius:8px;border:1px solid #e6f0ff;margin-top:10px}
    .q-left{display:flex;flex-direction:column;gap:8px}
    .q-row{display:flex;gap:20px;align-items:center;margin-top:4px}
    .q-row label{font-weight:500;display:flex;align-items:center;gap:6px}
    .q-actions{display:none;}

    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px;flex-wrap:wrap}
    .primary{background:var(--primary);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700}
    .secondary{background:#fff;border:1px solid #bfc9d6;padding:10px 14px;border-radius:10px;cursor:pointer}
    .toast{position:fixed;right:18px;bottom:18px;background:#063;color:#fff;padding:12px 16px;border-radius:10px;display:none}
    .toast.show{display:block}

    body.access-mode{
      --primary:#00264d;
      --bg:#ffffff;
      --text:#000;
      font-size:1.1em;
    }
    body.access-mode input, body.access-mode select, body.access-mode textarea{
      border:2px solid #000;
      background:#fff;
    }
    body.access-mode .chip{background:#fff;border:2px solid var(--primary)}
    body.access-mode .chip.selected{background:var(--primary);color:#fff}
    body.access-mode .question{border:2px solid #000;background:#fff;}
    body.access-mode .q-actions{display:flex;justify-content:flex-end;align-items:center;margin-top:6px;}
    body.access-mode .reading {box-shadow:0 0 0 4px rgba(255,203,79,0.4);border-color:var(--focus-color);}
    body.access-mode .tts-btn{background:#fff;border:2px solid #000;padding:8px;border-radius:8px;cursor:pointer}
    body.access-mode .tts-btn:focus{outline:3px solid var(--focus-color);outline-offset:2px}

    @media (max-width:768px){
      .hero{flex-direction:column}
      .thumb{width:100%;height:160px}
      .actions{flex-direction:column-reverse}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="https://pkmcibatu2025.github.io/satupintu/photo/logo.png" alt="Logo Puskesmas">
      <h1>Survey Kepuasan Masyarakat (IKM)</h1>
    </div>
    <nav>
      <a href="https://pkmcibatu2025.github.io/satupintu/" class="home">üè† Beranda</a>
      <button id="toggleAccess" class="access-btn">‚ôø Mode Aksesibilitas</button>
      <select id="langSelect" style="display:none;">
        <option value="id-ID">Bahasa Indonesia</option>
        <option value="en-US">English</option>
      </select>
      <button id="readAll" class="access-btn" style="display:none;">üîä Baca Semua</button>
    </nav>
  </header>

  <main>
    <div class="card">
      <div class="hero">
        <div class="thumb"></div>
        <div>
          <h2>Isi Formulir Survey</h2>
          <p>Silakan isi dengan jujur agar kami dapat meningkatkan mutu pelayanan di UPT Puskesmas Cibatu.</p>
        </div>
      </div>
    </div>

    <form id="ikmForm" class="card">
      <div class="grid">
        <div>
          <label for="nama">Nama (Opsional)</label>
          <input type="text" id="nama" name="nama" placeholder="Boleh dikosongkan">
        </div>
        <div>
          <label for="umur">Umur</label>
          <input type="number" id="umur" name="umur" min="1" placeholder="Contoh: 30" required>
        </div>
        <div>
          <label for="jk">Jenis Kelamin</label>
          <select id="jk" name="jk" required>
            <option value="">-- Pilih --</option>
            <option>Laki-laki</option>
            <option>Perempuan</option>
          </select>
        </div>
      </div>

      <div class="section-title">Jenis Pelayanan yang Diterima</div>
      <div class="services-wrap">
        <span class="chip" data-val="Pelayanan Umum">Pelayanan Umum</span>
        <span class="chip" data-val="Pelayanan Gigi">Pelayanan Gigi</span>
        <span class="chip" data-val="Pelayanan KIA">KIA</span>
        <span class="chip" data-val="Laboratorium">Laboratorium</span>
        <span class="chip" data-val="Farmasi">Farmasi</span>
        <span class="chip" data-val="Lainnya">Lainnya</span>
      </div>

      <div class="section-title">Pertanyaan Kepuasan</div>
      <div id="questions"></div>

      <div class="actions">
        <button type="button" id="resetBtn" class="secondary">üîÑ Reset</button>
        <button type="submit" id="submitBtn" class="primary">Kirim Jawaban</button>
      </div>
    </form>
  </main>

  <div id="toast" class="toast">‚úÖ Data berhasil dikirim!</div>

  <script>
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzRVMGI1-Rci2vEY77MaUhUPY5X0grs5pIoi1_FWfUpDEr7fxYe18HtjWJOZZg0wfEX/exec";

  const pertanyaan = [
    "Kesesuaian persyaratan pelayanan dengan jenis pelayanannya",
    "Kemampuan petugas dalam memberikan pelayanan",
    "Kemudahan prosedur pelayanan",
    "Perilaku petugas (kesopanan & keramahan)",
    "Kecepatan waktu dalam memberikan pelayanan",
    "Penanganan pengaduan pengguna layanan",
    "Kewajaran biaya/tarif dalam pelayanan",
    "Kualitas sarana dan prasarana",
    "Kesesuaian produk pelayanan dengan standar pelayanan"
  ];

  const qContainer = document.getElementById('questions');
  pertanyaan.forEach((text, idx) => {
    const i = idx + 1;
    const q = document.createElement('div');
    q.className = 'question';
    q.innerHTML = `
      <div class="q-left">
        <p style="margin:0;font-weight:700">${i}. ${text}</p>
        <div class="q-row" role="radiogroup" aria-label="Pertanyaan ${i}">
          <label><input required name="q${i}" type="radio" value="1"> 1</label>
          <label><input name="q${i}" type="radio" value="2"> 2</label>
          <label><input name="q${i}" type="radio" value="3"> 3</label>
          <label><input name="q${i}" type="radio" value="4"> 4</label>
        </div>
      </div>
      <div class="q-actions">
        <button type="button" class="tts-btn" data-q="${i}" title="Baca pertanyaan ${i}">üîä</button>
      </div>
    `;
    qContainer.appendChild(q);
  });

  const toggleAccess = document.getElementById('toggleAccess');
  const readAllBtn = document.getElementById('readAll');
  const langSelect = document.getElementById('langSelect');

  toggleAccess.addEventListener('click', () => {
    const active = document.body.classList.toggle('access-mode');
    toggleAccess.textContent = active ? "‚òÄÔ∏è Mode Normal" : "‚ôø Mode Aksesibilitas";
    readAllBtn.style.display = active ? 'inline-block' : 'none';
    langSelect.style.display = active ? 'inline-block' : 'none';
  });

  /* ====== TTS dengan voice pilihan ====== */
  let synth = window.speechSynthesis;
  let voices = [];

  function loadVoices() {
    voices = synth.getVoices();
    if (voices.length === 0) setTimeout(loadVoices, 500);
  }
  loadVoices();
  if (typeof speechSynthesis !== "undefined") {
    speechSynthesis.onvoiceschanged = loadVoices;
  }

  function getVoiceByLang(langCode) {
    return voices.find(v => v.lang.toLowerCase().startsWith(langCode.toLowerCase()))
        || voices.find(v => v.lang.startsWith('en'))
        || voices[0];
  }

  function speak(text, lang='id-ID', onstart=null, onend=null){
    if(!document.body.classList.contains('access-mode')) return;
    synth.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    utter.voice = getVoiceByLang(lang);
    utter.rate = 1;
    utter.pitch = 1;
    utter.onstart = onstart;
    utter.onend = onend;
    synth.speak(utter);
  }

  function readQuestion(idx){
    if(!document.body.classList.contains('access-mode')) return;
    const qEl = document.querySelector(`.tts-btn[data-q="${idx}"]`).closest('.question');
    const lang = langSelect.value || 'id-ID';
    const textID = `${idx}. ${pertanyaan[idx-1]}. Pilih nilai 1 sampai 4.`;
    const textEN = `${idx}. ${pertanyaan[idx-1]}. Please select a value from 1 to 4.`;
    const toRead = (lang === 'en-US') ? textEN : textID;
    qEl.classList.add('reading');
    speak(toRead, lang, null, ()=> qEl.classList.remove('reading'));
  }

  document.addEventListener('click', e=>{
    if(e.target.classList.contains('tts-btn')){
      readQuestion(e.target.dataset.q);
    }
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    const form = document.getElementById('ikmForm');
    form.reset();
    document.querySelectorAll('.chip.selected').forEach(c=>c.classList.remove('selected'));
  });

  document.querySelectorAll('.chip').forEach(btn=>{
    btn.addEventListener('click', ()=> btn.classList.toggle('selected'));
  });

  document.getElementById('ikmForm').addEventListener('submit', async (ev)=>{
    ev.preventDefault();
    const form = ev.target;
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true; submitBtn.textContent = 'Mengirim...';
    const fm = new FormData(form);
    const data = Object.fromEntries(fm.entries());
    data.services = Array.from(document.querySelectorAll('.chip.selected')).map(el=>el.dataset.val).join('; ');
    data.timestamp = new Date().toISOString();

    const allQ = pertanyaan.every((_,i)=>form.querySelector(`input[name="q${i+1}"]:checked`));
    if(!allQ){ alert('Mohon isi semua pertanyaan.'); submitBtn.disabled=false; submitBtn.textContent='Kirim Jawaban'; return; }

    try{
      const res = await fetch(WEBAPP_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      const j = await res.json();
      if(j.status==='success'){
        const toast=document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(()=>toast.classList.remove('show'),3000);
        form.reset();
        document.querySelectorAll('.chip.selected').forEach(c=>c.classList.remove('selected'));
      } else alert('Gagal mengirim data');
    }catch(e){alert('Terjadi kesalahan: '+e.message);}
    finally{submitBtn.disabled=false;submitBtn.textContent='Kirim Jawaban';}
  });
  </script>
</body>
</html>
