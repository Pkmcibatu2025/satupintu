
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penilaian Pegawai oleh Pasien</title>
    <!-- Bootstrap CSS untuk modal -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome untuk ikon bintang -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f8f9fa; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: #333; }
        .employee-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .employee-card { border: 1px solid #ddd; border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: transform 0.2s; }
        .employee-card:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .employee-photo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .employee-name { font-weight: bold; color: #333; }
        /* Modal custom */
        .modal-content { border-radius: 15px; }
        .star { font-size: 2rem; color: #ddd; cursor: pointer; transition: color 0.2s; }
        .star.active { color: #ffc107; }
        .star:hover { color: #ffc107; }
        .star:hover ~ .star { color: #ddd; } /* Hover effect untuk bintang sebelumnya */
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">Penilaian Pegawai oleh Pasien</h1>
        <p class="header">Pilih pegawai untuk memberikan ulasan dan rating.</p>
        
        <div id="employeeGrid" class="employee-grid"></div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Berikan Ulasan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <img id="modalPhoto" src="" alt="Foto Pegawai" class="img-fluid rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                        <h5 id="modalName" class="mt-2"></h5>
                        <h6 id="modalJabatan" class="mt-2"></h6>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Rating (1-5 Bintang):</label>
                        <div class="d-flex justify-content-center">
                            <i class="star fas fa-star" data-rating="1"></i>
                            <i class="star fas fa-star" data-rating="2"></i>
                            <i class="star fas fa-star" data-rating="3"></i>
                            <i class="star fas fa-star" data-rating="4"></i>
                            <i class="star fas fa-star" data-rating="5"></i>
                        </div>
                        <input type="hidden" id="selectedRating" value="0">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Ulasan:</label>
                        <textarea class="form-control" id="reviewText" rows="4" placeholder="Ceritakan pengalaman Anda..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="submitReview">Kirim Ulasan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data karyawan (sample 5, tambah 102 di sini. Format: {id: 1, name: 'Nama', photo: 'URL Foto'})
        const employees = [
            {id: 1, name: 'Dr. Dinan Bagja Nugraha', jabatan: 'Kepala UPT Puskesmas Cibatu, MM.Kes', photo: 'https://drive.google.com/uc?export=view&id=12ofwiwuG0soL0SjNutw9QOWTxxyjiQPU'},
            {id: 2, name: 'Erwin Kurniawan S.Kep', jabatan: 'Kasubbag TU', photo: 'https://drive.google.com/uc?export=view&id=1JGtEyUaYCyRVpQMgEVbUUQia3Xaq8O7a'},
            {id: 3, name: 'Eneng Sri Komalasari', jabatan: 'Bidan Desa Padasuka', photo: 'https://drive.google.com/uc?export=view&id=1zaoIYeIBR5jUgsAx6SFeqiNF1FrzL2sN'},
            {id: 4, name: 'Widia Nurani', jabatan: 'Ahli Gizi', photo: 'https://drive.google.com/uc?export=view&id=1J4yiMd3e9aVRcD2phV0kKaR5zh04q73S'},
            {id: 5, name: 'Nendi Yuwansah', jabatan: 'Administrasi Kepegawaian', photo: 'https://drive.google.com/uc?export=view&id=1W90VQUghuUwnswuqaJyPR4iCd1SavRxC'}
            // Tambah lebih banyak: {id: 6, name: 'Nama Lain', photo: 'URL' }, dst. sampai 102
        ];

        // Render grid karyawan
        const grid = document.getElementById('employeeGrid');
        employees.forEach(emp => {
            const card = document.createElement('div');
            card.className = 'employee-card';
            card.innerHTML = `
                <img src="${emp.photo}" alt="${emp.name}" class="employee-photo">
                <div class="employee-name">${emp.name}</div>
                <div class="employee-jabatan">${emp.jabatan}</div>
            `;
            card.onclick = () => openModal(emp);
            grid.appendChild(card);
        });

        // Buka modal
        function openModal(emp) {
            document.getElementById('modalTitle').textContent = `Ulasan untuk ${emp.name}`;
            document.getElementById('modalName').textContent = emp.name;
            document.getElementById('modalJabatan').textContent = emp.jabatan;
            document.getElementById('modalPhoto').src = emp.photo;
            document.getElementById('selectedRating').value = 0;
            document.getElementById('reviewText').value = '';
            resetStars();
            new bootstrap.Modal(document.getElementById('reviewModal')).show();
            currentEmployee = emp; // Simpan data emp untuk submit
        }

        let currentEmployee = null;

        // Rating bintang interactive
        document.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', function() {
                const rating = this.dataset.rating;
                document.getElementById('selectedRating').value = rating;
                setStars(rating);
            });
        });

        function setStars(rating) {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function resetStars() {
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
        }

        // Submit ulasan ke Google Sheets
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzUzEDckpeoRcNi4Gn8lJ9pwc7cNuIt7c-vWGEWBW1zPbFCSGXFFf8r_p2npqcjGG5mkA/exec'; // GANTI DENGAN URL WEB APP KAMU
        document.getElementById('submitReview').addEventListener('click', async () => {
            const rating = document.getElementById('selectedRating').value;
            const review = document.getElementById('reviewText').value.trim();

            if (rating == 0) {
                alert('Pilih rating bintang dulu!');
                return;
            }
            if (review === '') {
                alert('Isi ulasan minimal 10 karakter.');
                return;
            }

            const data = {
                namaKaryawan: currentEmployee.name,
                rating: rating,
                ulasan: review,
                timestamp: new Date().toLocaleString('id-ID')
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Karena CORS issue, pakai no-cors (data tetap terkirim)
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                alert('Ulasan berhasil dikirim ke spreadsheet!');
                bootstrap.Modal.getInstance(document.getElementById('reviewModal')).hide();
            } catch (error) {
                alert('Error: ' + error.message + '. Cek koneksi atau setup script.');
            }
        });
    </script>
</body>
</html>
